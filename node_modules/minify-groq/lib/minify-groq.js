"use strict";

function buildQuery(parts, args) {
  var len = parts.length;
  var query = '';

  for (var i = 0; i < len; i++) {
    query += parts[i];

    if (i < len - 1) {
      query += JSON.stringify(args[i]);
    }
  }

  return query;
}

function charIsWhiteSpace(char) {
  return char === ' ' || char === '\n' || char === '\t';
}

function minify(groqQuery) {
  for (var _len = arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {
    args[_key - 1] = arguments[_key];
  }

  var query = Array.isArray(groqQuery) ? buildQuery(groqQuery, args) : groqQuery;
  var len = query.length;

  if (len === 0) {
    return '';
  }

  var out = '';
  var pos = 0;
  var inSingle = false;
  var inDouble = false;

  do {
    var prev = query[pos - 1];
    var char = query[pos];
    var isWhiteSpace = charIsWhiteSpace(char);
    var prevWasWhiteSpace = charIsWhiteSpace(prev);
    pos++;

    if (char === '"' && prev !== '\\') {
      inDouble = !inDouble;
      out += char;
      continue;
    }

    if (char === "'" && prev !== '\\') {
      inSingle = !inSingle;
      out += char;
      continue;
    }

    if (inSingle || inDouble) {
      out += char;
      continue;
    }

    if (isWhiteSpace && prevWasWhiteSpace) {
      continue;
    }

    out += char;
  } while (pos < len);

  return out.trim();
}

module.exports = minify;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9taW5pZnktZ3JvcS5qcyJdLCJuYW1lcyI6WyJidWlsZFF1ZXJ5IiwicGFydHMiLCJhcmdzIiwibGVuIiwibGVuZ3RoIiwicXVlcnkiLCJpIiwiSlNPTiIsInN0cmluZ2lmeSIsImNoYXJJc1doaXRlU3BhY2UiLCJjaGFyIiwibWluaWZ5IiwiZ3JvcVF1ZXJ5IiwiQXJyYXkiLCJpc0FycmF5Iiwib3V0IiwicG9zIiwiaW5TaW5nbGUiLCJpbkRvdWJsZSIsInByZXYiLCJpc1doaXRlU3BhY2UiLCJwcmV2V2FzV2hpdGVTcGFjZSIsInRyaW0iLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiOztBQUFBLFNBQVNBLFVBQVQsQ0FBb0JDLEtBQXBCLEVBQTJCQyxJQUEzQixFQUFpQztBQUMvQixNQUFNQyxHQUFHLEdBQUdGLEtBQUssQ0FBQ0csTUFBbEI7QUFDQSxNQUFJQyxLQUFLLEdBQUcsRUFBWjs7QUFDQSxPQUFLLElBQUlDLENBQUMsR0FBRyxDQUFiLEVBQWdCQSxDQUFDLEdBQUdILEdBQXBCLEVBQXlCRyxDQUFDLEVBQTFCLEVBQThCO0FBQzVCRCxJQUFBQSxLQUFLLElBQUlKLEtBQUssQ0FBQ0ssQ0FBRCxDQUFkOztBQUNBLFFBQUlBLENBQUMsR0FBR0gsR0FBRyxHQUFHLENBQWQsRUFBaUI7QUFDZkUsTUFBQUEsS0FBSyxJQUFJRSxJQUFJLENBQUNDLFNBQUwsQ0FBZU4sSUFBSSxDQUFDSSxDQUFELENBQW5CLENBQVQ7QUFDRDtBQUNGOztBQUVELFNBQU9ELEtBQVA7QUFDRDs7QUFFRCxTQUFTSSxnQkFBVCxDQUEwQkMsSUFBMUIsRUFBZ0M7QUFDOUIsU0FBT0EsSUFBSSxLQUFLLEdBQVQsSUFBZ0JBLElBQUksS0FBSyxJQUF6QixJQUFpQ0EsSUFBSSxLQUFLLElBQWpEO0FBQ0Q7O0FBRUQsU0FBU0MsTUFBVCxDQUFnQkMsU0FBaEIsRUFBb0M7QUFBQSxvQ0FBTlYsSUFBTTtBQUFOQSxJQUFBQSxJQUFNO0FBQUE7O0FBQ2xDLE1BQU1HLEtBQUssR0FBR1EsS0FBSyxDQUFDQyxPQUFOLENBQWNGLFNBQWQsSUFBMkJaLFVBQVUsQ0FBQ1ksU0FBRCxFQUFZVixJQUFaLENBQXJDLEdBQXlEVSxTQUF2RTtBQUNBLE1BQU1ULEdBQUcsR0FBR0UsS0FBSyxDQUFDRCxNQUFsQjs7QUFDQSxNQUFJRCxHQUFHLEtBQUssQ0FBWixFQUFlO0FBQ2IsV0FBTyxFQUFQO0FBQ0Q7O0FBRUQsTUFBSVksR0FBRyxHQUFHLEVBQVY7QUFDQSxNQUFJQyxHQUFHLEdBQUcsQ0FBVjtBQUNBLE1BQUlDLFFBQVEsR0FBRyxLQUFmO0FBQ0EsTUFBSUMsUUFBUSxHQUFHLEtBQWY7O0FBRUEsS0FBRztBQUNELFFBQU1DLElBQUksR0FBR2QsS0FBSyxDQUFDVyxHQUFHLEdBQUcsQ0FBUCxDQUFsQjtBQUNBLFFBQU1OLElBQUksR0FBR0wsS0FBSyxDQUFDVyxHQUFELENBQWxCO0FBQ0EsUUFBTUksWUFBWSxHQUFHWCxnQkFBZ0IsQ0FBQ0MsSUFBRCxDQUFyQztBQUNBLFFBQU1XLGlCQUFpQixHQUFHWixnQkFBZ0IsQ0FBQ1UsSUFBRCxDQUExQztBQUNBSCxJQUFBQSxHQUFHOztBQUVILFFBQUlOLElBQUksS0FBSyxHQUFULElBQWdCUyxJQUFJLEtBQUssSUFBN0IsRUFBbUM7QUFDakNELE1BQUFBLFFBQVEsR0FBRyxDQUFDQSxRQUFaO0FBQ0FILE1BQUFBLEdBQUcsSUFBSUwsSUFBUDtBQUNBO0FBQ0Q7O0FBRUQsUUFBSUEsSUFBSSxLQUFLLEdBQVQsSUFBZ0JTLElBQUksS0FBSyxJQUE3QixFQUFtQztBQUNqQ0YsTUFBQUEsUUFBUSxHQUFHLENBQUNBLFFBQVo7QUFDQUYsTUFBQUEsR0FBRyxJQUFJTCxJQUFQO0FBQ0E7QUFDRDs7QUFFRCxRQUFJTyxRQUFRLElBQUlDLFFBQWhCLEVBQTBCO0FBQ3hCSCxNQUFBQSxHQUFHLElBQUlMLElBQVA7QUFDQTtBQUNEOztBQUVELFFBQUlVLFlBQVksSUFBSUMsaUJBQXBCLEVBQXVDO0FBQ3JDO0FBQ0Q7O0FBRUROLElBQUFBLEdBQUcsSUFBSUwsSUFBUDtBQUNELEdBN0JELFFBNkJTTSxHQUFHLEdBQUdiLEdBN0JmOztBQStCQSxTQUFPWSxHQUFHLENBQUNPLElBQUosRUFBUDtBQUNEOztBQUVEQyxNQUFNLENBQUNDLE9BQVAsR0FBaUJiLE1BQWpCIiwic291cmNlc0NvbnRlbnQiOlsiZnVuY3Rpb24gYnVpbGRRdWVyeShwYXJ0cywgYXJncykge1xuICBjb25zdCBsZW4gPSBwYXJ0cy5sZW5ndGhcbiAgbGV0IHF1ZXJ5ID0gJydcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBsZW47IGkrKykge1xuICAgIHF1ZXJ5ICs9IHBhcnRzW2ldXG4gICAgaWYgKGkgPCBsZW4gLSAxKSB7XG4gICAgICBxdWVyeSArPSBKU09OLnN0cmluZ2lmeShhcmdzW2ldKVxuICAgIH1cbiAgfVxuXG4gIHJldHVybiBxdWVyeVxufVxuXG5mdW5jdGlvbiBjaGFySXNXaGl0ZVNwYWNlKGNoYXIpIHtcbiAgcmV0dXJuIGNoYXIgPT09ICcgJyB8fCBjaGFyID09PSAnXFxuJyB8fCBjaGFyID09PSAnXFx0J1xufVxuXG5mdW5jdGlvbiBtaW5pZnkoZ3JvcVF1ZXJ5LCAuLi5hcmdzKSB7XG4gIGNvbnN0IHF1ZXJ5ID0gQXJyYXkuaXNBcnJheShncm9xUXVlcnkpID8gYnVpbGRRdWVyeShncm9xUXVlcnksIGFyZ3MpIDogZ3JvcVF1ZXJ5XG4gIGNvbnN0IGxlbiA9IHF1ZXJ5Lmxlbmd0aFxuICBpZiAobGVuID09PSAwKSB7XG4gICAgcmV0dXJuICcnXG4gIH1cblxuICBsZXQgb3V0ID0gJydcbiAgbGV0IHBvcyA9IDBcbiAgbGV0IGluU2luZ2xlID0gZmFsc2VcbiAgbGV0IGluRG91YmxlID0gZmFsc2VcblxuICBkbyB7XG4gICAgY29uc3QgcHJldiA9IHF1ZXJ5W3BvcyAtIDFdXG4gICAgY29uc3QgY2hhciA9IHF1ZXJ5W3Bvc11cbiAgICBjb25zdCBpc1doaXRlU3BhY2UgPSBjaGFySXNXaGl0ZVNwYWNlKGNoYXIpXG4gICAgY29uc3QgcHJldldhc1doaXRlU3BhY2UgPSBjaGFySXNXaGl0ZVNwYWNlKHByZXYpXG4gICAgcG9zKytcblxuICAgIGlmIChjaGFyID09PSAnXCInICYmIHByZXYgIT09ICdcXFxcJykge1xuICAgICAgaW5Eb3VibGUgPSAhaW5Eb3VibGVcbiAgICAgIG91dCArPSBjaGFyXG4gICAgICBjb250aW51ZVxuICAgIH1cblxuICAgIGlmIChjaGFyID09PSBcIidcIiAmJiBwcmV2ICE9PSAnXFxcXCcpIHtcbiAgICAgIGluU2luZ2xlID0gIWluU2luZ2xlXG4gICAgICBvdXQgKz0gY2hhclxuICAgICAgY29udGludWVcbiAgICB9XG5cbiAgICBpZiAoaW5TaW5nbGUgfHwgaW5Eb3VibGUpIHtcbiAgICAgIG91dCArPSBjaGFyXG4gICAgICBjb250aW51ZVxuICAgIH1cblxuICAgIGlmIChpc1doaXRlU3BhY2UgJiYgcHJldldhc1doaXRlU3BhY2UpIHtcbiAgICAgIGNvbnRpbnVlXG4gICAgfVxuXG4gICAgb3V0ICs9IGNoYXJcbiAgfSB3aGlsZSAocG9zIDwgbGVuKVxuXG4gIHJldHVybiBvdXQudHJpbSgpXG59XG5cbm1vZHVsZS5leHBvcnRzID0gbWluaWZ5XG4iXX0=